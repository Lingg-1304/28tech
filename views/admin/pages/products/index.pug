extends ../../layouts/default.pug
include ../../mixins/search.pug
block main
  if success && success.length
    each msg in success
      .alert.alert-success.alert-dismissible.fade.show.message-alert= msg
        button.close(type="button" data-dismiss="alert" aria-label="Close")
          span(aria-hidden="true") &times;

  if error && error.length
    each msg in error
      .alert.alert-danger.alert-dismissible.fade.show.message-alert= msg
        button.close(type="button" data-dismiss="alert" aria-label="Close")
          span(aria-hidden="true") &times;

  .container.mt-0
    h1.mb-4 Quản lý sản phẩm
      .row.mb-4
        .col-md-6
          a.btn.btn-primary(href=prefixAdmin + '/products/create')
            i.fas.fa-plus-circle.mr-1
            | Thêm sản phẩm 
        .col-md-6
          form(id="form-status")
            if status === undefined
              button.btn.btn-secondary(type="submit", name="status", value="") Tất cả
            else 
              button.btn.btn-outline-secondary(type="submit", name="status", value="") Tất cả
            if status === "active"
              button.btn.btn-success(type="submit", name="status", value="active") Còn bán
            else 
              button.btn.btn-outline-success(type="submit", name="status", value="active") Còn bán
            if status === "inactive"
              button.btn.btn-danger(type="submit", name="status", value="inactive") Dừng bán
            else 
              button.btn.btn-outline-danger(type="submit", name="status", value="inactive") Dừng bán
          +search(keyword)
    
    table.table.table-bordered.table-hover
      thead.thead-dark
        tr
          th STT
          th Ảnh
          th Tên
          th Giá
          th Giảm giá
          th Tồn kho
          th Trạng thái
          th Hành động
      tbody
        if products.length
          each item, index in products
            tr
              td #{index + (currentPage-1)*5 + 1}
              td 
                img(src=item.thumbnail, alt=item.title, width="60", height="60", style="object-fit: cover;")
              td #{item.title}
              td #{item.price} $
              td #{item.discountPercentage}%
              td #{item.stock}
              td 
                form(method="POST", action=`/admin/products/change-status/${item.status === 'active' ? 'inactive' : 'active'}/${item._id}`, style="display:inline;")
                  input(type="hidden", name="currentPage", value=currentPage)
                  if item.status === 'active'
                    button.btn.btn-sm.btn-success(type="submit") Còn bán
                  else
                    button.btn.btn-sm.btn-danger(type="submit") Dừng bán
                  

              td
                a.btn.btn-sm.btn-info(href=`${prefixAdmin}/products/edit/${item._id}`) Sửa
                form(method="POST", action=`${prefixAdmin}/products/delete/${item._id}?_method=DELETE`, style="display: inline;")
                  button.btn.btn-sm.btn-danger.ml-2(type="submit" onclick="return confirm('Bạn có chắc muốn xoá?')") Xoá

        else
          tr
            td(colspan="8").text-center Không có sản phẩm nào.
    if totalPages > 1
      nav.mt-4
        ul.pagination.justify-content-center

          // Nút "Trước"
          li.page-item(class=(currentPage === 1 ? 'disabled' : ''))
            a.page-link(
              href=`?page=${currentPage - 1}${status ? `&status=${status}` : ''}${keyword ? `&keyword=${keyword}` : ''}`
            ) Trước

          // Các nút số trang
          each num in [...Array(totalPages).keys()].map(n => n + 1)
            li.page-item(class=(num === currentPage ? 'active' : ''))
              a.page-link(
                href=`?page=${num}${status ? `&status=${status}` : ''}${keyword ? `&keyword=${keyword}` : ''}`
              ) #{num}

          // Nút "Sau"
          li.page-item(class=(currentPage === totalPages ? 'disabled' : ''))
            a.page-link(
              href=`?page=${currentPage + 1}${status ? `&status=${status}` : ''}${keyword ? `&keyword=${keyword}` : ''}`
            ) Sau

  script(src="/admin/js/product.js")   

  